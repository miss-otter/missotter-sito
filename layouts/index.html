{{ define "main" }}
<div class="home-journal">
  
  {{ $breadcrumbs := where .Site.RegularPages "Section" "breadcrumbs" }}
  {{ $posts := $breadcrumbs.ByDate.Reverse }}
  
  {{ if ge (len $posts) 1 }}
  <div class="journal-three-col">
    
    {{ $featured := index $posts 0 }}
    {{ $secondary := after 1 $posts }}
    {{ $leftPosts := first 2 $secondary }}
    {{ $rightPosts := first 2 (after 2 $secondary) }}
    
    <div class="journal-col-left">
      {{ range $leftPosts }}
      {{ $post := . }}
      {{ $postImage := "" }}
      {{ with $post.Params.image }}
        {{ $postImage = printf "%s%s" $post.Permalink . }}
      {{ else }}
        {{ $img := $post.Resources.GetMatch "*.{jpg,jpeg,png,gif,webp}" }}
        {{ with $img }}
          {{ $postImage = .RelPermalink }}
        {{ end }}
      {{ end }}
      <article class="journal-side-card">
        {{ if $postImage }}
        <a href="{{ $post.Permalink }}" class="journal-side-image">
          <img src="{{ $postImage }}" alt="{{ $post.Title }}">
        </a>
        {{ end }}
        <h3><a href="{{ $post.Permalink }}">{{ $post.Title }}</a></h3>
        <time>{{ $post.Date.Format "2 Jan 2006" }}</time>
        <p>{{ $post.Summary | truncate 80 }}</p>
      </article>
      {{ end }}
    </div>
    
    <div class="journal-col-center">
      {{ $featuredImage := "" }}
      {{ with $featured.Params.image }}
        {{ $featuredImage = printf "%s%s" $featured.Permalink . }}
      {{ else }}
        {{ $img := $featured.Resources.GetMatch "*.{jpg,jpeg,png,gif,webp}" }}
        {{ with $img }}
          {{ $featuredImage = .RelPermalink }}
        {{ end }}
      {{ end }}
      <article class="journal-main-card">
        {{ if $featuredImage }}
        <a href="{{ $featured.Permalink }}" class="journal-main-image">
          <img src="{{ $featuredImage }}" alt="{{ $featured.Title }}">
        </a>
        {{ end }}
        <h2><a href="{{ $featured.Permalink }}">{{ $featured.Title }}</a></h2>
        <time>{{ $featured.Date.Format "2 January 2006" }}</time>
        <p>{{ $featured.Summary | truncate 300 }}</p>
        <a href="{{ $featured.Permalink }}" class="read-more">Continua a leggere</a>
      </article>
    </div>
    
    <div class="journal-col-right">
      {{ range $rightPosts }}
      {{ $post := . }}
      {{ $postImage := "" }}
      {{ with $post.Params.image }}
        {{ $postImage = printf "%s%s" $post.Permalink . }}
      {{ else }}
        {{ $img := $post.Resources.GetMatch "*.{jpg,jpeg,png,gif,webp}" }}
        {{ with $img }}
          {{ $postImage = .RelPermalink }}
        {{ end }}
      {{ end }}
      <article class="journal-side-card">
        {{ if $postImage }}
        <a href="{{ $post.Permalink }}" class="journal-side-image">
          <img src="{{ $postImage }}" alt="{{ $post.Title }}">
        </a>
        {{ end }}
        <h3><a href="{{ $post.Permalink }}">{{ $post.Title }}</a></h3>
        <time>{{ $post.Date.Format "2 Jan 2006" }}</time>
        <p>{{ $post.Summary | truncate 80 }}</p>
      </article>
      {{ end }}
    </div>
    
  </div>
  
  {{ if gt (len $posts) 5 }}
  <div class="journal-more">
    <a href="/breadcrumbs/">Vedi tutti i post</a>
  </div>
  {{ end }}
  
  {{ else }}
  <p>Nessun post ancora.</p>
  {{ end }}
  
</div>
{{ end }}
